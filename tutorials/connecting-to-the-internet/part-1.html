<h1 id="part-1---scan-for-available-networks">Part 1 - Scan for Available Networks</h1>

<p>The BitsyExpander board not only provides solderless connectors but also adds WiFi capabilities to your ItsyBitsy microcontroller. To use it, the WiFi radio must be set up in code - like any other component. It uses pins <strong><code class="language-plaintext highlighter-rouge">D9</code></strong>, <strong><code class="language-plaintext highlighter-rouge">D11</code></strong>, and <strong><code class="language-plaintext highlighter-rouge">D12</code></strong>, as well as the <strong><code class="language-plaintext highlighter-rouge">SPI</code></strong> pins (<strong><code class="language-plaintext highlighter-rouge">SCK</code></strong>, <strong><code class="language-plaintext highlighter-rouge">MISO</code></strong>, and <strong><code class="language-plaintext highlighter-rouge">MOSI</code></strong>).</p>

<p>The code below shows you how to configure the WiFi module. It scans for available networks and prints your microcontroller’s MAC address to the Serial Monitor.</p>

<ol>
  <li>
    <p>Connect your ItsyBitsy and Expander to your computer.</p>
  </li>
  <li>
    <p>Copy the example code below and use <code class="language-plaintext highlighter-rouge">Mu Editor</code> to save it to your <code class="language-plaintext highlighter-rouge">code.py</code> file. Remember to back up your old code elsewhere.</p>
  </li>
  <li>
    <p>Open the <code class="language-plaintext highlighter-rouge">Serial Monitor</code> to verify that your microcontroller can find a network to connect to in the next step.</p>
  </li>
  <li>
    <p>Store or write down your WiFi module’s <a href="../../glossary/glossary">MAC address</a>; it will become important later.</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">board</span>
<span class="kn">import</span> <span class="nn">busio</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">digitalio</span>
<span class="kn">from</span> <span class="nn">adafruit_esp32spi</span> <span class="kn">import</span> <span class="n">adafruit_esp32spi</span>
   
<span class="c1"># Define the pins used by the BitsyExpander's ESP32 WiFi module
</span><span class="n">esp32_cs</span> <span class="o">=</span> <span class="n">digitalio</span><span class="p">.</span><span class="n">DigitalInOut</span><span class="p">(</span><span class="n">board</span><span class="p">.</span><span class="n">D9</span><span class="p">)</span>
<span class="n">esp32_ready</span> <span class="o">=</span> <span class="n">digitalio</span><span class="p">.</span><span class="n">DigitalInOut</span><span class="p">(</span><span class="n">board</span><span class="p">.</span><span class="n">D11</span><span class="p">)</span>
<span class="n">esp32_reset</span> <span class="o">=</span> <span class="n">digitalio</span><span class="p">.</span><span class="n">DigitalInOut</span><span class="p">(</span><span class="n">board</span><span class="p">.</span><span class="n">D12</span><span class="p">)</span>
<span class="n">spi</span> <span class="o">=</span> <span class="n">busio</span><span class="p">.</span><span class="n">SPI</span><span class="p">(</span><span class="n">board</span><span class="p">.</span><span class="n">SCK</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">MOSI</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">MISO</span><span class="p">)</span>
   
<span class="c1"># Initialize the ESP32 WiFi module
</span><span class="n">esp</span> <span class="o">=</span> <span class="n">adafruit_esp32spi</span><span class="p">.</span><span class="n">ESP_SPIcontrol</span><span class="p">(</span><span class="n">spi</span><span class="p">,</span> <span class="n">esp32_cs</span><span class="p">,</span> <span class="n">esp32_ready</span><span class="p">,</span> <span class="n">esp32_reset</span><span class="p">)</span>
         
<span class="k">if</span> <span class="n">esp</span><span class="p">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">adafruit_esp32spi</span><span class="p">.</span><span class="n">WL_IDLE_STATUS</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">ESP32 WiFi Module found."</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Firmware version:"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">esp</span><span class="p">.</span><span class="n">firmware_version</span><span class="p">,</span> <span class="s">"utf-8"</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"*"</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
       
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Scanning for available networks..."</span><span class="p">)</span>
    <span class="c1"># Add SSID of each Access Point (ap) in range to network_list
</span>    <span class="n">network_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">ap</span><span class="p">[</span><span class="s">"ssid"</span><span class="p">],</span> <span class="s">"utf-8"</span><span class="p">)</span> <span class="k">for</span> <span class="n">ap</span> <span class="ow">in</span> <span class="n">esp</span><span class="p">.</span><span class="n">scan_networks</span><span class="p">()]</span> 
    <span class="k">print</span><span class="p">(</span><span class="n">network_list</span><span class="p">)</span>
       
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">MAC Address:"</span><span class="p">)</span>
    <span class="c1"># Format the MAC address (reverse byte order and format hex values)    
</span>    <span class="n">mac_addr</span> <span class="o">=</span> <span class="s">":"</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">"{:02X}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span> <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">esp</span><span class="p">.</span><span class="n">MAC_address</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">mac_addr</span><span class="p">)</span>
       
    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span> <span class="s">"*"</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ol>

<p class="note">Starting with this tutorial, code examples will include so-called <a href="../../glossary/glossary">comments</a>. Comments exist to document the code and are ignored by the program. They are meant to help you and others understand the code better. In CircuitPython, comments begin with the <strong><code class="language-plaintext highlighter-rouge">#</code></strong> character.</p>

<p><a href="part-2" class="btn btn-blue">Next Step</a></p>

