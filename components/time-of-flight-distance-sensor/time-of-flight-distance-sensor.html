<p><img src="assets/ToF_v2_VL53L0X.png" alt="Time of Flight Sensor Version 2" width="250" /></p>

<h1 id="time-of-flight-distance-sensor">Time of Flight Distance Sensor</h1>
<p><a href="../../glossary/glossary"><img src="../../glossary/assets/input.png" alt="Input" width="72" /></a> <a href="../../glossary/glossary"><img src="../../glossary/assets/iic.png" alt="I²C" width="72" /></a></p>

<p>Detects the distance of objects directly in front of the sensor. Works best with white surfaces, for a range from 30 to 1200 mm. Works most reliably between 50 and 950 mm.</p>

<p class="note"><img src="assets/ToF_v1_VL53L0X_nomargins.png" alt="Time of Flight Sensor Version 1" style="float: right; margin: 10px 0px 10px 15px;" width="90" />The sensor included in your kit may look like the one pictured above or like the one pictured here. Both versions are functionally identical. The information in this article is valid no matter which version you own.</p>

<p>Additional information is available on <a href="https://learn.adafruit.com/adafruit-vl53l0x-micro-lidar-distance-sensor-breakout">this page</a>, discussing a similar component based on the same sensor.</p>

<p>Additional code examples are available <a href="https://github.com/adafruit/Adafruit_CircuitPython_VL53L0X/tree/main/examples">here</a>.</p>

<hr />

<h2 id="preparation">Preparation</h2>

<p>This Distance Sensor communicates with your microcontroller using a protocol called <a href="../../glossary/glossary">I²C</a>. To work, it must be connected to a port labeled <strong>I²C</strong> on the BitsyExpander Board. You will need to include the <code class="language-plaintext highlighter-rouge">adafruit_bus_device</code> <a href="../../glossary/glossary">library</a> in your code to read data via I²C and the <code class="language-plaintext highlighter-rouge">adafruit_vl53l0x</code> library to control the <a href="https://www.adafruit.com/product/3317">VL53L0X</a> sensor itself.</p>

<p>These libraries should already be installed on the ItsyBitsy Microcontroller included in your kit, so you don’t need to worry about installing them yourself.</p>

<p class="highlight">You can verify that these libraries are installed by ensuring a folder named <code class="language-plaintext highlighter-rouge">adafruit_bus_device</code> and a file called <code class="language-plaintext highlighter-rouge">adafruit_vl53l0x.mpy</code> are present in the <code class="language-plaintext highlighter-rouge">lib</code> folder of your <code class="language-plaintext highlighter-rouge">CIRCUITPY</code> drive. If not, download Adafruit’s Library Bundle for Version 8.x <a href="https://circuitpython.org/libraries">here</a>. Extract the needed file and folder from the bundle and place them in the <code class="language-plaintext highlighter-rouge">lib</code> folder on your microcontroller. You can learn more about libraries and their use in the <a href="../../glossary/glossary">Glossary</a> or the <a href="../../Tutorials">Tutorials</a>.</p>

<h2 id="basic-usage">Basic Usage</h2>

<p>Make sure to include <code class="language-plaintext highlighter-rouge">busio</code> and <code class="language-plaintext highlighter-rouge">adafruit_vl53l0x</code> in the imports section of your code to use the required libraries.</p>

<p>The first step to using the sensor is setting up the connection by creating an <code class="language-plaintext highlighter-rouge">I2C</code> <a href="../../glossary/glossary">object</a> named <code class="language-plaintext highlighter-rouge">i2c_port</code>. Then, <code class="language-plaintext highlighter-rouge">dist_sensor = adafruit_vl53l0x.VL53L0X(i2c_port)</code> is used to create an <a href="../../glossary/glossary">instance</a> of the sensor named <code class="language-plaintext highlighter-rouge">dist_sensor</code> and connected to <code class="language-plaintext highlighter-rouge">i2c_port</code>. In the example code below, this is done in the <em>Variables</em> section.</p>

<p>In the main loop, the <code class="language-plaintext highlighter-rouge">print()</code> function outputs distance readings retrieved from the sensor using <code class="language-plaintext highlighter-rouge">dist_sensor.range</code>, along with explanatory labels.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># --- Imports
</span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">board</span>
<span class="kn">import</span> <span class="nn">busio</span>
<span class="kn">import</span> <span class="nn">adafruit_vl53l0x</span>

<span class="c1"># --- Declarations
</span><span class="n">i2c_port</span> <span class="o">=</span> <span class="n">busio</span><span class="p">.</span><span class="n">I2C</span><span class="p">(</span><span class="n">board</span><span class="p">.</span><span class="n">SCL</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">SDA</span><span class="p">)</span>

<span class="c1"># --- Functions
</span>
<span class="c1"># --- Setup
</span><span class="n">dist_sensor</span> <span class="o">=</span> <span class="n">adafruit_vl53l0x</span><span class="p">.</span><span class="n">VL53L0X</span><span class="p">(</span><span class="n">i2c_port</span><span class="p">)</span>

<span class="c1"># --- Main loop
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Range:"</span><span class="p">,</span> <span class="n">dist_sensor</span><span class="p">.</span><span class="nb">range</span><span class="p">,</span> <span class="s">"mm"</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="using-multiple-sensors">Using Multiple Sensors</h2>

<p class="note">Some soldering is required to follow these instructions. If this is your first time soldering, begin by reading the <a href="../../tutorials/assembling-custom-components/soldering">Soldering Tutorial</a>.</p>

<p class="warning">If following this tutorial with a microcontroller other than the one included in the Connected Interaction Kit, make sure it uses 3.3V logic. The XSHUT pin of the sensor cannot handle 5V logic and would need <a href="https://www.kiwi-electronics.com/en/4-channel-i2c-safe-bi-directional-logic-level-converter-bss138-837">level shifting</a> to work with 5V microcontrollers.</p>

<p>The <strong>I²C</strong> connectors on the BitsyExpander board all share the same two digital pins (<strong>SCL</strong> and <strong>SDA</strong>), as <a href="../../glossary/glossary">I²C</a> is a communication protocol that enables multiple components to share the same so-called I²C bus. To organize communication, each device on the bus must have a unique address. Typically, unique addresses are assigned by default to different components. However, if you need to use multiple identical parts, they will all have the same default address, causing a conflict.</p>

<p><img src="assets/Dual_VL53L0X_ToF_nocable.png" alt="Time of Flight Sensor Version 2" /></p>

<p>For example, the VL530X Distance Sensor’s default address is <strong>0x29</strong>. To use more than one of them, their addresses must first be reassigned. This can be done in code by following these steps:</p>

<ul>
  <li>At the start of the program, all connected sensors must be turned off by driving their shutdown pins low (labeled <strong>XSHT</strong> or <strong>XSHUT</strong>). Before that can be done, a new cable must be soldered to connect the sensor’s shutdown pin to a digital pin on the microcontroller. Follow the wiring diagram above to connect two sensors.</li>
  <li>In the code’s setup section, <code class="language-plaintext highlighter-rouge">switch_to_output(value=False)</code> configures the pins connected to XSHUT as outputs with a default value of False to turn off the sensors.</li>
  <li>Next, the first sensor is turned on by driving its XSHUT pin high with <code class="language-plaintext highlighter-rouge">xshut_sensor1.value = True</code>, and initialized in the same manner as in the first example.</li>
  <li>Finally, the <code class="language-plaintext highlighter-rouge">set_address()</code> function is used to change the sensor’s address.</li>
  <li>These steps are then repeated for the remaining sensors. In this example, the addresses of both connected sensors are changed. In principle, the last sensor could retain its default address.</li>
</ul>

<p>Note that these steps only need to be performed once, which is why they are performed in the code’s setup section. Once configured, the sensors can be used normally.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># --- Imports
</span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">board</span>
<span class="kn">import</span> <span class="nn">busio</span>
<span class="kn">import</span> <span class="nn">digitalio</span>
<span class="kn">import</span> <span class="nn">adafruit_vl53l0x</span>

<span class="c1"># --- Declarations
</span><span class="n">i2c_port</span> <span class="o">=</span> <span class="n">busio</span><span class="p">.</span><span class="n">I2C</span><span class="p">(</span><span class="n">board</span><span class="p">.</span><span class="n">SCL</span><span class="p">,</span> <span class="n">board</span><span class="p">.</span><span class="n">SDA</span><span class="p">)</span>
<span class="n">xshut_sensor1</span> <span class="o">=</span> <span class="n">digitalio</span><span class="p">.</span><span class="n">DigitalInOut</span><span class="p">(</span><span class="n">board</span><span class="p">.</span><span class="n">D2</span><span class="p">)</span>
<span class="n">xshut_sensor2</span> <span class="o">=</span> <span class="n">digitalio</span><span class="p">.</span><span class="n">DigitalInOut</span><span class="p">(</span><span class="n">board</span><span class="p">.</span><span class="n">D3</span><span class="p">)</span>

<span class="c1"># --- Functions
</span>
<span class="c1"># --- Setup
</span><span class="n">xshut_sensor1</span><span class="p">.</span><span class="n">switch_to_output</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">xshut_sensor2</span><span class="p">.</span><span class="n">switch_to_output</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">xshut_sensor1</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">dist_sensor1</span> <span class="o">=</span> <span class="n">adafruit_vl53l0x</span><span class="p">.</span><span class="n">VL53L0X</span><span class="p">(</span><span class="n">i2c_port</span><span class="p">)</span>
<span class="n">dist_sensor1</span><span class="p">.</span><span class="n">set_address</span><span class="p">(</span><span class="mh">0x30</span><span class="p">)</span>

<span class="n">xshut_sensor2</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">dist_sensor2</span> <span class="o">=</span> <span class="n">adafruit_vl53l0x</span><span class="p">.</span><span class="n">VL53L0X</span><span class="p">(</span><span class="n">i2c_port</span><span class="p">)</span>
<span class="n">dist_sensor2</span><span class="p">.</span><span class="n">set_address</span><span class="p">(</span><span class="mh">0x31</span><span class="p">)</span>

<span class="c1"># --- Main loop
</span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">print</span><span class="p">((</span><span class="n">dist_sensor1</span><span class="p">.</span><span class="nb">range</span><span class="p">,</span> <span class="n">dist_sensor2</span><span class="p">.</span><span class="nb">range</span><span class="p">))</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
</code></pre></div></div>

<p class="note">If you need more than three sensors or want to avoid soldering, consider using an <a href="https://learn.adafruit.com/adafruit-tca9548a-1-to-8-i2c-multiplexer-breakout/">I²C Multiplexer</a> or <a href="https://learn.adafruit.com/circuitpython-essentials/circuitpython-i2c#wheres-my-i2c-2985160">configuring a second I²C bus</a> instead.</p>

<h2 id="additional-resources">Additional Resources</h2>

<h3 id="working-with-ic-devices"><a href="https://learn.adafruit.com/working-with-i2c-devices">Working with I²C Devices</a></h3>

<p>Adafruit’s extensive learning resource on the I²C standard</p>

<h3 id="resolving-ic-address-conflicts"><a href="https://learn.adafruit.com/working-with-multiple-i2c-devices">Resolving I²C Address Conflicts</a></h3>

<p>Adafruit’s guide exploring methods to resolve I²C address conflicts</p>
